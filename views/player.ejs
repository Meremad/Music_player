<%- include('partials/header') %>
<h1 class="text-3xl font-bold mb-4">Music Player</h1>
<div class="mb-4">
    <input type="text" id="searchInput" placeholder="Search for songs" class="w-full px-3 py-2 border rounded">
    <button onclick="searchSongs()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Search</button>
</div>

<div id="searchResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
<div id="player" class="mt-8"></div>

<script>
function searchSongs() {
    const query = document.getElementById('searchInput').value;
    fetch(`/player/search?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '';
            data.tracks.items.forEach(track => {
                const trackDiv = document.createElement('div');
                trackDiv.className = 'border p-4 rounded';
                trackDiv.innerHTML = `
                    <h3 class="font-bold">${track.name}</h3>
                    <p>${track.artists[0].name}</p>
                    <img src="${track.album.images[0].url}" style="width:300px" class="mt-2 mb-2">
                    <button onclick="playSong('${track.id}')" class="mt-2 bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">Play</button>
                    <a href="/player/details?artist=${track.artists[0].name}&title=${track.name}" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">Details</a>
                    `;
                resultsDiv.appendChild(trackDiv);
            });
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while searching for songs. Please try again.');
        });
}

function playSong(trackId) {
    fetch(`/player/play/${trackId}`)
        .then(response => response.json())
        .then(data => {
            const playerDiv = document.getElementById('player');
            playerDiv.innerHTML = `
                <h2 class="text-2xl font-bold mb-2">${data.name}</h2>
                <p class="mb-2">${data.artists[0].name}</p>
                <audio controls src="${data.preview_url}" class="w-full mb-4"></audio>
                <button onclick="getVideo('${data.name} ${data.artists[0].name}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Watch Video</button>
            `;
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while playing the song. Please try again.');
        });
}

function getVideo(query) {
    fetch(`/player/video?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            const playerDiv = document.getElementById('player');
            playerDiv.innerHTML += `
                                <h3 class="text-xl font-bold mb-2">Music Video</h3>
                <div class="mt-4"  style="display: flex; justify-content: center; align-items: center; margin: 20px;">
                    <iframe  width="1200px" height="500px" src="https://www.youtube.com/embed/${data.videoId}" frameborder="0" allowfullscreen src="https://www.youtube.com/embed/${data.videoId}" frameborder="0" allowfullscreen></iframe>
                </div>
            `;
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while fetching the video. Please try again.');
        });
}

</script>

<%- include('partials/footer') %>